<!DOCTYPE html>
<html lang="en-US">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="/assets/css/style.css?v=1db909fa1f06ea7ae5dc1a7973fa98b17f58e65a" media="screen" type="text/css">
    <link rel="stylesheet" href="/assets/css/print.css" media="print" type="text/css">
<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <![endif]-->

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>FM-impl | hahadsg’s note</title>
<meta name="generator" content="Jekyll v3.9.3">
<meta property="og:title" content="FM-impl">
<meta property="og:locale" content="en_US">
<link rel="canonical" href="https://hahadsg.github.io/ComputationalAdvertising/CTR/FM_impl.html">
<meta property="og:url" content="https://hahadsg.github.io/ComputationalAdvertising/CTR/FM_impl.html">
<meta property="og:site_name" content="hahadsg’s note">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2019-10-11T00:00:00+00:00">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="FM-impl">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2019-10-11T00:00:00+00:00","datePublished":"2019-10-11T00:00:00+00:00","headline":"FM-impl","mainEntityOfPage":{"@type":"WebPage","@id":"https://hahadsg.github.io/ComputationalAdvertising/CTR/FM_impl.html"},"url":"https://hahadsg.github.io/ComputationalAdvertising/CTR/FM_impl.html"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>
    <header>
      <div class="inner">
        <a href="https://hahadsg.github.io/">
          <h1>hahadsg's note</h1>
        </a>
        <h2></h2>
        
        
          <a href="https://github.com/hahadsg" class="button"><small>Follow me on</small> GitHub</a>
        
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1 id="fm实现和实践的感想">FM实现和实践的感想</h1>

<ol>
  <li>特征工程对FM很重要，所有特征都要0到1之间，否则很容易梯度爆炸</li>
</ol>

<p>因为FM梯度的公式中，有v和x相乘的项，如果x比1大，v减去梯度后绝对值也大于了1，在接下去不断迭代中，梯度会越来越大就会爆炸到NaN（注意：这里说的梯度公式有v和x相乘只是强调非线性的，梯度公式实际是\(x_i\sum^n_{j=1}v_{j,f}x_j - v_{i,f}x_i^2\)；另外，这里说的x比1大，实际情况中x要比1大比较多才会爆炸，因为还要乘上学习率）</p>

<ol>
  <li>为什么在实际使用中，使用业务上的数据集（非广告点击的），FM并没有比逻辑回归或者线性回归好很多，是不是代码写错了？</li>
</ol>

<p>很多业务数据集可能交叉特征起的作用较小，另外FM也只有2阶的交叉</p>

<p>也有可能是超参没调好，因为使用SGD时超参很难调</p>

<p>也可以看看这个数据集是不是数据量较少，FM的参数较多，需要更多的数据集去训练（不过我个人觉得，主要还是数据集2阶交叉作用小）</p>

<ol>
  <li>怎么知道是不是代码写错了？</li>
</ol>

<p>针对回归问题可以生成一个数据集：随机生成FM的参数\(b, W, V\)，随机生成几列特征，根据FM公式算出y（注意查看交叉项在y中起到的作用，不能太小，如果太小的话就调整参数\(V\)），然后跑FM，看看FM能不能你和这个数据集，然后跑线性回归会发现无法拟合，说明FM是起作用了的</p>

<p>观察过拟合后的FM参数，会发现\(b, W\)和前面生成的几乎一样，不过\(V\)跟生成的不一致，这一点我还没有想通为什么\(V\)不一致</p>

<p>（分类问题怎么生成数据集我还没想到）</p>

<ol>
  <li>使用论文的SGD进行梯度下降，超参很难调（学习率、衰减）</li>
</ol>

<p>可以尝试使用Adma等优化方法</p>

<h1 id="初始化值的影响">初始化值的影响</h1>

<h2 id="交叉项的初始值不能初始化为0">交叉项的初始值不能初始化为0</h2>

<p>这个是显而易见的，可以用公式解释，因为根据梯度的公式\(x_i\sum^n_{j=1}v_{j,f}x_j - v_{i,f}x_i^2\)，所以梯度会一直为0</p>

<p>一般使用高斯分布随机生成，标准差是一个超参</p>

<h2 id="线性项和bias的初始值最好是0">线性项和bias的初始值最好是0</h2>

<p>如果线性项也是用高斯分布随机生成，那么进行梯度下降的时候，损失期初会很大，而且震荡的很厉害，过了很多epoch才开始持续下降，例如下面的样子；如果初始值是0，就会稳定很多，刚开始的损失就是小于1的，而且很快就能稳定下降</p>

<p>猜测可能是因为初始化为0更接近局部最优解？</p>

<p>1.740649101566134
7.497113213794938
23.470090105163354
33.14111546385315
23.64511919004669
6.267136596203574
2.578806955609892
0.8825661954724465
1.7365348114229828
1.402942023240411
3.2613090844310455
1.99784127432739
0.576489521298484
0.626364890834019
0.8571547081514205
0.694086822224672
1.0119341925383027
0.5176361858707219
0.566816029669394
0.5218835304759538
0.5742864521338142
0.48195460860116923
0.4986442936522203
0.4416475534933967
0.43817710178437264
0.40896395200093033
0.39986457681211457
0.3857665226355063
0.37796208753335386
0.3705438278410384</p>

<h1 id="fm的性质">FM的性质</h1>

<h2 id="生成模拟交叉特征的数据集让fm完全拟合回归">生成模拟交叉特征的数据集，让FM完全拟合（回归）</h2>

<p>预先定义好FM的V、W、b，然后随机生成X，根据公式得到y，生成10000个数据，使用FM训练让其完全过拟合（即损失几乎为0）</p>

<p>最开始设置了k=2，特征数3个，FM的确会完全拟合数据集，但是V跟预先定义的值不同，而W、b跟预先定义的值几乎一致。进一步观察，V虽然不同，但是\(&lt;v_i, v_j&gt;\)是跟预先的值完全一致的，每次跑都能出现完全不同的V，也就是FM可能会有无数多个最优解？从数学上怎么证明呢？在逻辑回归上也会出现这种现象么？</p>

<p>我也猜测过是不是因为特征数太少，导致了过拟合，尝试了k=2，特征数10个，现象是一样的</p>


        </section>

        <aside id="sidebar">
          

          

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</p>

          <p>由于笔记大部分来自于我之前的gitbook，可能会因为markdown规范不同导致公式显示错误，如果有显示错误请<a href="https://github.com/hahadsg/hahadsg.github.io/issues">找我</a>，感谢</p>
        </aside>
      </div>
    </div>

    
  </body>
</html>
