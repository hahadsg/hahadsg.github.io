<!DOCTYPE html>
<html lang="en-US">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="/assets/css/style.css?v=1db909fa1f06ea7ae5dc1a7973fa98b17f58e65a" media="screen" type="text/css">
    <link rel="stylesheet" href="/assets/css/print.css" media="print" type="text/css">
<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <![endif]-->

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>xDeepFM | hahadsg’s note</title>
<meta name="generator" content="Jekyll v3.9.3">
<meta property="og:title" content="xDeepFM">
<meta property="og:locale" content="en_US">
<link rel="canonical" href="https://hahadsg.github.io/ComputationalAdvertising/CTR/xDeepFM.html">
<meta property="og:url" content="https://hahadsg.github.io/ComputationalAdvertising/CTR/xDeepFM.html">
<meta property="og:site_name" content="hahadsg’s note">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2019-09-25T00:00:00+00:00">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="xDeepFM">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2019-09-25T00:00:00+00:00","datePublished":"2019-09-25T00:00:00+00:00","headline":"xDeepFM","mainEntityOfPage":{"@type":"WebPage","@id":"https://hahadsg.github.io/ComputationalAdvertising/CTR/xDeepFM.html"},"url":"https://hahadsg.github.io/ComputationalAdvertising/CTR/xDeepFM.html"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>
    <header>
      <div class="inner">
        <a href="https://hahadsg.github.io/">
          <h1>hahadsg's note</h1>
        </a>
        <h2></h2>
        
        
          <a href="https://github.com/hahadsg" class="button"><small>Follow me on</small> GitHub</a>
        
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1 id="xdeepfm--cin">xDeepFM / CIN</h1>

<p>eXtreme Deep Factorization Machine (xDeepFM) 提出了一种新的网络Compressed Interaction Network (CIN)，在DCN的基础上进一步提升了基于FM的深度学习结构</p>

<p>xDeepFM的改进点主要是：DCN的交叉是bit-wise，而CIN的交叉是vector-wise的。bit-wise是指将所有特征embedding后放到一个向量中，即同一个特征embedding的每个元素进到DCN网络后都是一个”新的特征”，同一个embedding的各个元素也会交叉；而vector-wise是指将所有特征embedding后，每个特征都是一个向量，即有一个field的概念，进入CIN后是embedding向量与向量间的交叉</p>

<h2 id="cin结构">CIN结构</h2>

<p>我们先看看CIN怎么做vector-wise product的：</p>

<p><img src="./assets/xDeepFM/CIN-a.png" alt="drawing" width="400"></p>

<p>图中的\(x^0\)是最开始的特征，大小为\(m \times D\)，\(m\)是特征数，\(D\)是embedding维度数；\(x^k\)都是CIN的中间过程，大小为\(H_k \times D\)，\(H_k\)是自己设定的，代表中间层隐含的特征数。\(z^{k+1}\)是根据\({x^k}\)和\(x^0\)得到的，是第k层和第0层在D上的每个维度的外积，这样就是vector-wise的，因为每个embedding的每个元素是一一对应相乘的，然后因为做了外积，所以得到了第k层和第0层每个特征embedding之间的乘积（第1层是第0层跟第0层做外积，相当于FM的交叉部分了）</p>

<p>这样得到的\(z^{k+1}\)还需要进行压缩（否则形状就无法进行下一次迭代了）：</p>

<p><img src="./assets/xDeepFM/CIN-b.png" alt="drawing" width="400"></p>

<p>可以看到图中将\(z^{k+1} \in \mathbb{R}^{H_k \times m \times D}\)压缩到了\(x^{k+1} \in \mathbb{R}^{H_{k+1} \times D}\)，这样就可以继续进行下一次迭代了</p>

<p>计算公式为：</p>

\[X^k_{h,*} = \sum\limits^{H_{k-1}}_{i=1} \sum\limits^m_{j=1} W^{k,h}_{ij} \left( X^{k-1}_{i,*} \circ X^0_{j,*} \right)\]

<p>CIN整体结构：</p>

<p><img src="./assets/xDeepFM/CIN-c.png" alt="drawing" width="400"></p>

<p>可以看到CIN不断从上一层和第0层得到新的一层，有点像RNN的结构，通过这种设计得到了High-Order的FM。这里跟DCN不同的是，DCN每一层是1阶到k阶所有的项，而CIN每层就是k阶的项，所以这里做了sum pooling，把所有阶输出到一个全连接层，得到最终的High-Order的FM</p>

<h2 id="cin复杂度分析">CIN复杂度分析</h2>

<p>CIN参数量为：\(\sum^T_{k=1} H_k \times (1 + H_{k-1} \times m)\)</p>

<p>所以空间复杂度为：\(O(mTH^2)\)（假设每层的\(H_k\)一样，\(T\)就是层数）</p>

<p>作为对比，DNN部分的空间复杂度为：\(O(mDH+TH^2)\)</p>

<p>时间复杂度为：\(O(mH^2DT)\)，作为对比，DNN部分时间复杂度为：\(O(mHD+H^2T)\)</p>

<p>所以CIN的瓶颈在时间复杂度上，他的复杂度比DNN部分还要高</p>

<h2 id="xdeepfm整体结构">xDeepFM整体结构</h2>

<p><img src="./assets/xDeepFM/Architecture.png" alt="drawing" width="500"></p>

<p>最左边是Linear部分，中间是CIN部分，最右边是DNN部分，其他的分布跟DCN一样，变化的地方就是CIN</p>

<h1 id="参考">参考</h1>

<p><a href="https://arxiv.org/pdf/1803.05170.pdf">xDeepFM: Combining Explicit and Implicit Feature Interactions for Recommender Systems</a></p>

        </section>

        <aside id="sidebar">
          

          

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</p>

          <p>由于笔记大部分来自于我之前的gitbook，可能会因为markdown规范不同导致公式显示错误，如果有显示错误请<a href="https://github.com/hahadsg/hahadsg.github.io/issues">找我</a>，感谢</p>
        </aside>
      </div>
    </div>

    
  </body>
</html>
